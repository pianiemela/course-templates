<!DOCTYPE HTML>
<html>

<head>

    <head>
        <title>GeoGebra and JavaScript</title>

    </head>
</head>

<body>
    <div>
        <table border="0" width="600">


            <h2>Event listeners</h2>

            <p>This page shows how to register JavaScript functions as
                listeners to changes in a GeoGebra
                construction. See <a
                    href="https://www.geogebra.org/manual/en/Reference:JavaScript#Event_listeners">Event Listeners</a>
                for a syntax description of the used
                methods.
            </p>
            <script type="text/javascript" src="https://cdn.geogebra.org/apps/deployggb.js"></script>
            <script type="text/javascript">
                var parameters = {
                    "prerelease": false, "width": 600, "height": 450,
                    "showToolBar": true, "borderColor": null, "showMenuBar": false, "showAlgebraInput": true,
                    "showResetIcon": true, "enableLabelDrags": false, "enableShiftDragZoom": true, "enableRightClick": true, "capturingThreshold": null, "showToolBarHelp": false,
                    "errorDialogsActive": true, "useBrowserForJS": true,
                    "showLogging": "true", "showToolBar": true
                };


                parameters.appletOnLoad = function (api) {
                    var strLength = 150;
                    api.evalCommand("A=(0,0)");
                    // var textarea1 = document.getElementsByName("textarea1")[0];
                    // var textarea2 = document.getElementsByName("textarea2")[0];
                    // var consState = document.getElementsByName("consState")[0];

                    function addListener(objName) {
                        console.log("addListener0 ",objName);

                        textarea1.value = "add: " + objName + "\n" + textarea1.value.substring(0, strLength);
                        if (objName === "v") {
                            data = api.getValueString("v");
                            data2 = api.getValueString("f");
                            parent.postMessage(data+"; "+data2, "*");
                        }

                        printConstructionState();
                    }



                    function removeListener(objName) {
                        textarea1.value = "remove: " + objName + "\n" + textarea1.value.substring(0, strLength);
                        printConstructionState();
                    }

                    function renameListener(oldObjName, newObjName) {
                        textarea1.value = "rename: " + objName + "\n" + textarea1.value.substring(0, strLength);
                        printConstructionState();
                    }

                    function updateListener(objName) {
                        data = api.getValueString("v");
                        data2 = api.getValueString("f");
                        parent.postMessage(data+"; "+data2, "*");

                        // strVal = api.getValueString(objName);
                        // textarea2.value = objName + ": " + strVal + "\n" + textarea2.value.substring(0, strLength);
                    }

                    function clearListener() {
                        textarea1.value = "";
                        textarea2.value = "";
                        textarea1.value = "construction cleared";
                        consState.value = "";
                        v.value = "";
                    }

                    function printConstructionState() {
                        var objNumber = api.getObjectNumber();
                        var strState = "Number of objects: " + objNumber;
                        for (i = 0; i < objNumber; i++) {
                            strName = api.getObjectName(i);
                            strType = api.getObjectType(strName);
                            strCommand = api.getCommandString(strName);
                            strValue = api.getValue(strName);
                            strValueString = api.getValueString(strName);

                            strState += "\n" + strType + " " + strName + ", " + strValue + ", " + strCommand + ", " + strValueString;
                        }

                        consState.value = strState;

                    }
                    // register add, remove, rename and update listeners
                    api.registerAddListener(addListener);
                    api.registerRemoveListener(removeListener);
                    api.registerRenameListener(renameListener);
                    api.registerClearListener(clearListener);
                    api.registerUpdateListener(updateListener);
                }


                var applet = new GGBApplet('5.0', parameters);
                //  when used with Math Apps Bundle, uncomment this:
                //  applet.setHTML5Codebase('GeoGebra/HTML5/5.0/web/');

                window.onload = function () {
                    applet.inject('applet_container');
                }
            </script>
            <p></p>
            <div id="applet_container"></div>
             <style>
                label {
                    display: block;
                }
            </style>
        </table>

    </div>
</body>

</html>